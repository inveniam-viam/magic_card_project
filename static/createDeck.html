<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <title>Create a Deck</title>
    <link rel="stylesheet" href="css/createDeck.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script type="text/javascript">
      var cardList = [];

      async function getCard() {
        var cardName = document.getElementById("cardName").value;
        var cardQuantity = document.getElementById("cardQuantity").value;

        // Verifying the card and tracking the pair
        await $.ajax({
          type: "POST",
          url: "cards/verify",
          data: { card_name: cardName },
          dataType: "json",
          success: function(msg) {
            //Append to list above
            cardList.push({
              card_name: cardName,
              card_id: msg.card_id,
              amount: parseInt(cardQuantity)
            });
          },
          error: function(result) {
            console.log(result);
          }
        });

        console.log(cardList);
        populateCardList();
      }

      function populateCardList() {
        if (cardList.length != 0) {
          const cardListElement = document.getElementById("cardList");
          var cardListHtml = "";
          for (i = 0; i < cardList.length; i++) {
            var cardElement = `<h3 class="cardListElement"> ${cardList[i].card_name} : ${cardList[i].amount} </h3>`;
            cardListHtml += cardElement;
          }

          cardListElement.innerHTML = cardListHtml;
        }
      }

      async function createDeck(){
        //TODO
        var deckName = document.getElementById('deckName').value
        var userId = 2
        var cards = cardList

        var deckData = {user_id: userId, deck_name: deckName, cards: cards}

        await $.ajax({
          type: "POST",
          url: "decks",
          data: deckData,
          dataType: "json",
          success: function(msg) {
            // Create DECK
          },
          error: function(result) {
            console.log(result);
          }
        });


      }


    </script>
  </head>
  <body>
    <div class="createDeckContainer">
      <div class="deckNameContainer">
        <div><h1>Enter the name for the deck</h1></div>
        <div><input type="text" id="deckName" placeholder="Deck Name" /></div>
      </div>

      <div class="cardInputContainer">
        <div><h3>Card</h3></div>
        &nbsp;&nbsp;&nbsp;
        <div><input type="text" id="cardName" placeholder="Card Name" /></div>
        &nbsp;&nbsp;&nbsp;
        <div><h3>Quantity</h3></div>
        &nbsp;&nbsp;&nbsp;
        <div>
          <input type="text" id="cardQuantity" placeholder="Card Quantity" />
        </div>
        &nbsp;&nbsp;&nbsp;
        <div><button onclick="getCard()">Add</button></div>
        &nbsp;&nbsp;&nbsp;
      </div>

      <div class="cardsContainer">
        <div><h3>Card List:</h3></div>
        <br />
        <div id="cardList" class="cardList"></div>
      </div>

      <br />
      <div>
        <button onclick="createDeck()">Done</button>
      </div>
    </div>
  </body>
</html>
